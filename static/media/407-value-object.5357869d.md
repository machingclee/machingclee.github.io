---
title: Value Objects and Embedded Classes
date: 2025-08-23
id: blog0407
tag: springboot, kotlin
toc: true
intro: We study how to embed value object into JPA entity class definition, and study how to auto-map our value object back to plain DTO object for the frontend
img: spring
---

<style>
  video {
    border-radius: 4px;
  }
  img {
    max-width: 660px;
  }
</style>

#### Value Objects with @Embedded and @Embeddable Annotations

Consider the following `Student` entity

```kotlin-1{31-34}
@Entity
@DynamicInsert
@GenerateDTO
@Table(
    name = "student",
    schema = "public"
)
class Student(
    @Id
    @Column(name = "id")
    @GeneratedValue(generator = "ulid_as_uuid")
    var id: UUID? = null,
    @Column(name = "first_name", nullable = false)
    var firstName: String,
    @Column(name = "last_name", nullable = false)
    var lastName: String,
    @Column(name = "chinese_first_name")
    var chineseFirstName: String? = null,
    @Column(name = "chinese_last_name")
    var chineseLastName: String? = null,
    @Column(name = "school_name", nullable = false)
    var schoolName: String,
    @Column(name = "student_code")
    var studentCode: String? = null,
    @Column(name = "grade", nullable = false)
    var grade: String,
    @Column(name = "phone_number")
    var phoneNumber: String? = null,
    @Column(name = "wechat_id")
    var wechatId: String? = null,
    //@Column(name = "birthdate", nullable = false)
    //var birthdate: Double,
    @Embedded
    var birthdate: Birthdate,
```
Here we have simply changed the primitive type to a data class `Birthdate`, with the value object being defined by:

```kotlin 
package dev.james.alicetimetable.domain.valueObject

import jakarta.persistence.Column
import jakarta.persistence.Embeddable

@Embeddable
data class Birthdate(
    @Column(name = "birthdate", nullable = false)
    val value: Double,
) {
    init {
        require(value > 0) { "Birthdate must be positive" }
    }
}
```

Now the validation logic will take place automatically. Moreover, when we save the entity JPA will extract the `@Column`-annotate fields from the `@Embedded` fields.


This is a very powerful technique in DDD and JPA, now we can validate `Email`, `Address`, `PhoneNumber` etc value objects within the class itself and the data-persistence from JPA will automatically save the annotated fields into the database.

```kotlin-35
    @Column(name = "parent_email", nullable = false)
    var parentEmail: String,
    @Column(name = "created_at")
    var createdAt: Double? = null,
    @Column(name = "created_at_hk")
    var createdAtHk: String? = null,
    @Column(name = "parent_id")
    var parentId: UUID? = null,
    @Column(name = "gender", nullable = false)
    @Enumerated(EnumType.STRING)
    @JdbcType(PostgreSQLEnumJdbcType::class)
    var gender: Gender,
    @Column(name = "should_auto_renew_package")
    var shouldAutoRenewPackage: Boolean? = null,
    @Column(name = "is_active")
    @Suppress("INAPPLICABLE_JVM_NAME")
    @set:JvmName("setIsActive")
    var isActive: Boolean? = null,
    @Column(name = "preferred_name")
    var preferredName: String? = null,
    @Column(name = "remark")
    var remark: String? = null,
) : AbstractAggregateRoot<Student>() {
    ...
}
```

#### Interaction with `toDTO()` Method generated by kspKotlin

When we convert an entity class into a plain DTO object, there are two approches to instruct `kspKotlin` for data transform:

1. Keep it as `{ ..., brithday: { value: ... }}` 
2. Use the name in `@Column(name="some_name")` and convert it into a plain object with `someName` as one of the fields

We adopt the second approach as it makes no change to our codebase when we do the refactoring from a `String`-field to a `Birthday`-field. 

The following article 

- [Auto-generated Mapper From Entity Classes into DTO Classes](/blog/article/Auto-generated-Mapper-From-Entity-Classes-into-DTO-Classes#GenerateDTOProcessor)

has updated the `GenerateDTOProcessor` class to scan all the `@Embedded`-annotated fields, and then scan all `@Column`-annotated fields contained in it throughout the `toDTO()` code generation process.

