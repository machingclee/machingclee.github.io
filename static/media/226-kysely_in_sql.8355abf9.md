---
title: "Run Kysely Generated SQL in Tableplus"
date: 2023-12-23
id: blog0226
tag: sql
intro: "Record how to experiment with the sqls generated by query builder."
toc: false
---

<p></p>
<center></center>


In `express` if with log the query built by `kysely` via the config:

```js
export const db = new Kysely<DB>({
    dialect,
    log(event) {
        if (event.level === "query") {
            console.log(event.query.sql);
            console.log(event.query.parameters);
        }
    }
})
```
then we eventually get the following kind of queries to prevent sql injection:

```js
select *, (select to_json(obj) from (select count("MessagesSession"."id") as "count" from "MessagesSession" where "MessagesSession"."channelId" = "Channel"."id" and "MessagesSession"."hostUserId" = $1 and "MessagesSession"."isDeleted" != $2 and "MessagesSession"."isDraftInstantIssue" = $3) as obj) as "draft" from "Channel" where "Channel"."projectId" = $4 and "Channel"."isDeleted" = $5
[
  '77af0d8c-46aa-44c1-bb2b-730033cbf188',
  true,
  true,
  'ff515aff-d53f-407c-9c11-602998b74ba8',
  false
]
```

To exeucute this in our ordinary SQL shell we can `prepare` and `execute` it:

```sql
prepare plan(uuid, bool, bool, uuid, bool) as 
	select *, (select to_json(obj) from (select count("MessagesSession"."id") as "count" from "MessagesSession" where "MessagesSession"."channelId" = "Channel"."id" and "MessagesSession"."hostUserId" = $1 and "MessagesSession"."isDeleted" != $2 and "MessagesSession"."isDraftInstantIssue" = $3) as obj) as "draft" from "Channel" where "Channel"."projectId" = $4 and "Channel"."isDeleted" = $5;

execute plan(
  '77af0d8c-46aa-44c1-bb2b-730033cbf188',
  true,
  true,
  'ff515aff-d53f-407c-9c11-602998b74ba8',
  false
)
```
From this we get:

<p></p>

<a href="/assets/tech/226/image.png"><img src="/assets/tech/226/image.png" width="660"></a></Center>

<p></p>
<center></center>

Now we can investigate what's wrong with our query.